<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Kitap Yönetim Uygulaması</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>


</head>
<body>
    <div class="container mt-5">


        <div class="container">
            <button id="listBooks">Kitapları Listele </button>
            <button id="addBook"> Kitap Ekle </button>
            <button id="deleteBook"> Kitap Sil </button>
        </div>

        <div id="area" class="container mt-1">


        </div>









    </div>
    


    <script>
        document.getElementById("listBooks").addEventListener("click", function () {
            fetch("https://localhost:7044/api/Books")
                .then(response => {
                    if (!response.ok) throw new Error("Veri Alınamadı");
                    return response.json();
                })
                .then(data => {
                    const listeDiv = document.getElementById("area");
                    listeDiv.innerHTML = "";

                    if (data.length === 0) {
                        listeDiv.innerHTML = "<p>Kayıtlı kitap bulunamadı.</p>";
                        return;
                    }

                    const table = document.createElement("table");
                    table.className = "table table-striped";
                    const tr1 = document.createElement("tr");
                    const th1 = document.createElement("th");
                    const th2 = document.createElement("th");
                    const th3 = document.createElement("th");

                    th1.textContent = "Title";
                    th2.textContent = "Author";
                    th3.textContent = "Published Year";

                    tr1.appendChild(th1);
                    tr1.appendChild(th2);
                    tr1.appendChild(th3);
                    table.appendChild(tr1);

                    data.forEach(book => {
                        const trBook = document.createElement("tr");

                        const tdTitle = document.createElement("td");
                        const tdAuthor = document.createElement("td");
                        const tdPublishedYear = document.createElement("td");

                        tdTitle.textContent = book.title;
                        tdAuthor.textContent = book.author;
                        tdPublishedYear.textContent = book.publishedYear;

                        trBook.appendChild(tdTitle);
                        trBook.appendChild(tdAuthor);
                        trBook.appendChild(tdPublishedYear);

                        table.appendChild(trBook);
                        
                    });

                    listeDiv.appendChild(table);
                })
                .catch(error => {
                    console.error("Hata:", error);
                });
        });

        document.getElementById("addBook").addEventListener("click", function () {
            const area = document.getElementById("area");
            area.innerHTML = "";

            const inputTitle = document.createElement("input");
            inputTitle.type = "Text";
            inputTitle.placeholder = "Title";
            inputTitle.id = "idTitle";
            inputTitle.className = "form-control mb-2";

            const inputAuthor = document.createElement("input");
            inputAuthor.type = "Text";
            inputAuthor.placeholder = "Author";
            inputAuthor.id = "idAuthor";
            inputAuthor.className = "form-control mb-2";

            const inputYear = document.createElement("input");
            inputYear.type = "Text";
            inputYear.placeholder = "Published Year";
            inputYear.id = "idYear";
            inputYear.className = "form-control mb-2";

            const sendbtn = document.createElement("button");
            sendbtn.textContent = "Gönder";
            sendbtn.className = "btn btn-primary";

            

            area.appendChild(inputTitle);
            area.appendChild(inputAuthor);
            area.appendChild(inputYear);
            area.appendChild(sendbtn);


            sendbtn.addEventListener("click", function () {
                const title = encodeURIComponent(document.getElementById("idTitle").value);
                const author = encodeURIComponent(document.getElementById("idAuthor").value);
                const publishedYear = document.getElementById("idYear").value;

                // Query string ile gönderim
                const url = `https://localhost:7044/api/Books?title=${title}&author=${author}&publishedYear=${publishedYear}`;

                fetch(url, {
                    method: "POST"
                })
                    .then(response => {
                        if (!response.ok) throw new Error("Veri Gönderilemedi");

                        document.getElementById("idTitle").value = "";
                        document.getElementById("idAuthor").value = "";
                        document.getElementById("idYear").value = "";

                        alert("Kitap başarıyla eklendi!");
                        location.reload();
                    })
                    .catch(error => {
                        console.error("Hata:", error);
                        alert("Hata: " + error.message);
                    });
            });
        });

        document.getElementById("deleteBook").addEventListener("click", function () {
            const deleteArea = document.getElementById("area");
            deleteArea.innerHTML = "";

            const inputId = document.createElement("input");
            inputId.type = "number";
            inputId.placeholder = "Silmek istediğiniz Kitabın İd'si";
            inputId.id = "idDelete";
            inputId.className = "form-control mb-2"

            const sendbtn = document.createElement("button");
            sendbtn.textContent = "Sil";
            sendbtn.className = "btn btn-danger"; 

            deleteArea.appendChild(inputId);
            deleteArea.appendChild(sendbtn);

            sendbtn.addEventListener("click", function () {

                const id = document.getElementById("idDelete").value;

                if (!id) {
                    alert("Lütfen bir ID girin!");
                    return;
                }

                const url2 = "https://localhost:7044/api/Books/" + id;

                fetch(`https://localhost:7044/api/Books/${id}`, {
                    method: "DELETE"
                })
                    .then(response => {
                        if (!response.ok) throw new Error("Kitap silinemedi");
                        alert("Kitap başarıyla silindi!");
                        document.getElementById("idDelete").value = "";
                        location.reload(); 
                    })
                    .catch(error => {
                        console.error("Hata:", error);
                        alert("Hata: " + error.message);
                    });
            });
        });
       



       


    </script>








    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js" integrity="sha384-7qAoOXltbVP82dhxHAUje59V5r2YsVfBafyUDxEdApLPmcdhBPg1DKg1ERo0BZlK" crossorigin="anonymous"></script>
</body>
</html>